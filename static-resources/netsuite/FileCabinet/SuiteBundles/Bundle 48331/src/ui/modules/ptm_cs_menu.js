/** * Â© 2015 NetSuite Inc.  User may not copy, modify, distribute, or re-bundle or otherwise make available this code. */Ext4.define('PSA.RA.Menu', {    extend : 'Ext4.panel.Panel',    id : 'psa-menu',    renderTo : Ext4.get('main_form'),    layout : 'hbox',    border : false,    defaults : {        margin : '0 5 0 0'    },    items : [        Ext4.create('PSA.RA.UIComponent.BlueButton', {            text : 'Save',            id : 'saveButton',            handler : function() {                if (!PSA.RA.App.eventStore.areThereChanges()) {                    alert('No changes to save.');                    Ext4.getCmp('saveButton').enable();                    return;                }                PSA.RA.dataStores.chartEventSaver.transferModifiedRecords();                PSA.RA.dataStores.chartEventSaver.sync({                    success : function(batch) { //app.syncAllocToEventStore() // TODO                        var changed = false;                        //                        console.log(batch);                        if (batch.operations[0].success) {                            console.log('save success');                        } else {                            console.log('save failed');                        }                        PSA.RA.dataStores.chartEventSaver.data.each(function(item, index, len) {                            //                            console.log('sync : ' + item.raw.clientId + ' - ' + item.get('allocId') + ' -- ' + item.raw.allocId);                            if (item.raw.clientId && item.raw.clientId <= 0 && item.get('allocId') > 0) {                                var recX = PSA.RA.App.eventStore.findRecord('allocId', item.raw.clientId);                                if (recX) {                                    var rec = PSA.RA.App.eventStore.getById(recX.get('Id'));                                    //                                    console.log('sync : ' + rec.raw.allocId + ' - ' + rec.raw.Id);                                    if (rec && rec.get('allocId') <= 0) {                                        changed = true;                                        rec.beginEdit();                                        rec.set('allocId', item.get('allocId'));                                        rec.endEdit();                                    }                                }                            }                            // TODO: update hours/percentage value to server computed values?                        }, this);                        //                        console.log('sync : ' + 'is changed? ' + changed);                        //                        if (changed) {                        PSA.RA.App.eventStore.commitChanges();                        //                        }                        Ext4.getCmp('advFilterMain').enableFilter();                        alert('Successfully saved changes.');                        Ext4.getCmp('saveButton').enable();                        PSA.RA.dataStores.chartResource.loadWithFilters();                    },                    failure : function(batch) {                        alert('Save failed');                        Ext4.getCmp('saveButton').enable();                    }                });            },            listeners : {                click : function(button, event, eOpts) {                    button.disable(); // disable button temporarily to avoid "double" saving of changes.                }            }        }), Ext4.create('PSA.RA.UIComponent.GrayButton', {            id : 'ra-chartCancelBtn',            text : 'Cancel',            handler : function() {                window.history.go(-1);            }        }), Ext4.create('PSA.RA.UIComponent.GrayButton', {            id : 'ra-chartResetBtn',            text : 'Reset',            handler : function() {                PSA.RA.dataStores.chartResource.loadWithFilters();                Ext4.getCmp('advFilterMain').enableFilter();            }        }), Ext4.create('PSA.RA.UIComponent.MenuSeparator'), Ext4.create('PSA.RA.UIComponent.GrayButton', {            id : 'ra-chartSettingsBtn',            text : 'Settings',            handler : function() {                if (PSA.RA.App.eventStore.areThereChanges()) {                    alert('Please save changes before updating the settings.');                    return false;                }                PSA.RA.App.formSettings.show();            }        })    ]});