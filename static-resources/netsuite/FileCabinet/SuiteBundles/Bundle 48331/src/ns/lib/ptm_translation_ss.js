/** * Project Task Manager * RESX Translation : Server * * Version    Date          Author          Remarks *  1.00    2014 04 21      maquino         Initial version *  2.00    2014 05 30      pbtan           removed the defaults to english *  3.00    2014 06 06      pmiller         Added default return values for getEXTLang & getNSLang *  4.00    2014 06 13      pmiller         Removed hardcoded path -- resx files will now be loaded via their internalid; assumption: unique file name */PTMTranslationManager = {    defaultLang : 'en_US',    extLangMap : {        'cs_CZ' : 'cs',        'da_DK' : 'da',        'de_DE' : 'de',        'en' : 'en',        'en_US' : 'en',        'es_AR' : 'es',        'es_ES' : 'es',        'fr_CA' : 'fr_CA',        'fr_FR' : 'fr',        'it_IT' : 'it',        'ja_JP' : 'ja',        'ko_KR' : 'ko',        'nl_NL' : 'nl',        'pt_BR' : 'pt_BR',        'ru_RU' : 'ru',        'sv_SE' : 'sv_SE',        'th_TH' : 'th',        'zh_CN' : 'zh_CN',        'zh_TW' : 'zh_TW'    },    nsLangMap : {        'cs_CZ' : 'cs_CZ',        'da_DK' : 'da_DK',        'de_DE' : 'de_DE',        'en' : 'en_US',        'en_US' : 'en_US',        'es_AR' : 'es_AR',        'es_ES' : 'es_ES',        'fr_CA' : 'fr_CA',        'fr_FR' : 'fr_FR',        'it_IT' : 'it_IT',        'ja_JP' : 'ja_JP',        'ko_KR' : 'ko_KR',        'nl_NL' : 'nl_NL',        'pt_BR' : 'pt_BR',        'ru_RU' : 'ru_RU',        'sv_SE' : 'sv_SE',        'th_TH' : 'th_TH',        'zh_CN' : 'zh_CN',        'zh_TW' : 'zh_TW'    },    initResources : function() {        var startTime = new Date().getTime();        this.bundleID = nlapiGetContext().getBundleId();        this.prefLang = nlapiGetContext().getPreference('LANGUAGE');        nlapiLogExecution('DEBUG', 'PTMTranslationManager.prefLang', this.prefLang);        this.defaultXML = this.loadXML(this.defaultLang);        this.prefXML = this.loadXML(this.getNSLang());        nlapiLogExecution('DEBUG', 'PTMTranslationManager.initResources.runTime', (new Date().getTime() - startTime) + 'ms');    },    loadXML : function(lang) {        nlapiLogExecution('DEBUG', 'PTMTranslationManager.loadXML.lang', lang);        var fileName = "ptm_resource." + lang + ".resx.xml";        var fileId = this.getFileId(fileName);        var file = nlapiLoadFile(fileId);        var contentString = file.getValue().replace(/(\r\n|\n|\r)/gm, "");        if (lang == this.defaultLang) {            this.defaultRESXString = contentString;        } else {            this.prefRESXString = contentString;        }        return eval(contentString);    },    getEXTLang : function() {        return this.extLangMap[this.prefLang] || this.extLangMap[this.defaultLang];    },    getNSLang : function() {        return this.nsLangMap[this.prefLang] || this.nsLangMap[this.defaultLang];    },    getString : function(stringID) {        var pref = this.prefXML.data.(@name == stringID);        var def = this.defaultXML.data.(@name == stringID);        if (pref) return pref.value.toString();        else if (def) return pref.value.toString();        else return "ERROR";    },    getFileId : function(fileName) {        var result = nlapiSearchRecord("file", null, [            new nlobjSearchFilter("name", null, 'is', fileName)        ], [            new nlobjSearchColumn("internalid")        ]);        return result == null ? null : result[0].getValue("internalid");    }}PTMTranslationManager.initResources();